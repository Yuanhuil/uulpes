<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.njpes.www.dao.scaletoollib.ExamresultTeacherMapper">
	<resultMap id="BaseResultMap"
		type="com.njpes.www.entity.scaletoollib.ExamresultTeacher">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		<id column="id" property="id" jdbcType="BIGINT" />
		<result column="user_id" property="teacherId" jdbcType="BIGINT" />
		<result column="scale_id" property="scaleId" jdbcType="VARCHAR" />
		<result column="testtype" property="testtype" jdbcType="INTEGER" />
		<result column="ok_time" property="okTime" jdbcType="TIMESTAMP" />
		<result column="start_time" property="startTime" jdbcType="TIMESTAMP" />
		<result column="warning_grade" property="warningGrade"
			jdbcType="INTEGER" />
		<result column="iswarnsure" property="iswarnsure" jdbcType="TINYINT" />
		<result column="valid_val" property="validVal" jdbcType="INTEGER" />
	</resultMap>
	<resultMap id="ResultMapWithBLOBs"
		type="com.njpes.www.entity.scaletoollib.ExamresultTeacherWithBLOBs"
		extends="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		<result column="individual_score" property="individualScore"
			jdbcType="LONGVARCHAR" />
		<result column="question_score" property="questionScore"
			jdbcType="LONGVARCHAR" />
		<result column="dim_score" property="dimScore" jdbcType="LONGVARCHAR" />
	</resultMap>
	<resultMap id="TeaExamAnswer" type="com.njpes.www.entity.scaletoollib.TeacherExamAnswer">
	    <result column="xxmc" property="individualScore" jdbcType="LONGVARCHAR" />
		<result column="xbm" property="xbm"/>
		<result column="xm" property="xm" />
		<result column="scale_id" property="scaleid"/>
		<result column="question_score" property="answer" jdbcType="LONGVARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		id, user_id, scale_id, testtype,ok_time, start_time, warning_grade,
		valid_val
	</sql>
	<sql id="Blob_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		individual_score, question_score, dim_score
	</sql>
	<select id="selectByPrimaryKey" resultMap="ResultMapWithBLOBs"
		parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		select
		<include refid="Base_Column_List" />
		,
		<include refid="Blob_Column_List" />
		from examresult_teacher
		where id = #{id,jdbcType=BIGINT}
	</select>
	<select id="getTeacherAnswerByResultid" resultMap="TeaExamAnswer" parameterType="java.lang.Long">
	    select e.sfzjh,e.xm,e.gender xbm,e.scale_id,e.question_score
	    from examresult_teacher e 
	    where e.id=#{resultid}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		delete from examresult_teacher
		where id = #{id,jdbcType=BIGINT}
	</delete>
	<delete id="deleteBatch">
		delete from examresult_teacher
		where id in
		<foreach collection="array" index="index" item="item" open="(" separator="," close=")"> 
			#{item} 
		</foreach>
	</delete>
	<insert id="insert"
		parameterType="com.njpes.www.entity.scaletoollib.ExamresultTeacherWithBLOBs">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		insert into examresult_teacher (id, user_id, scale_id,testtype,
		ok_time, start_time, warning_grade,
		valid_val, individual_score, question_score,
		dim_score)
		values (#{id,jdbcType=BIGINT}, #{teacherId,jdbcType=BIGINT},
		#{scaleId,jdbcType=INTEGER},#{testtype,jdbcType=INTEGER},
		#{okTime,jdbcType=TIMESTAMP}, #{startTime,jdbcType=TIMESTAMP}, #{warningGrade,jdbcType=INTEGER},
		#{validVal,jdbcType=INTEGER}, #{individualScore,jdbcType=LONGVARCHAR},
		#{questionScore,jdbcType=LONGVARCHAR},
		#{dimScore,jdbcType=LONGVARCHAR})
	</insert>
	<insert id="insertSelective"
		parameterType="com.njpes.www.entity.scaletoollib.ExamresultTeacherWithBLOBs">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		insert into examresult_teacher
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="teacherId != null">
				user_id,
			</if>
			<if test="scaleId != null">
				scale_id,
			</if>
			<if test="testtype != null">
				testtype,
			</if>
			<if test="okTime != null">
				ok_time,
			</if>
			<if test="startTime != null">
				start_time,
			</if>
			<if test="warningGrade != null">
				warning_grade,
			</if>
			<if test="validVal != null">
				valid_val,
			</if>
			<if test="individualScore != null">
				individual_score,
			</if>
			<if test="questionScore != null">
				question_score,
			</if>
			<if test="dimScore != null">
				dim_score,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=BIGINT},
			</if>
			<if test="teacherId != null">
				#{teacherId,jdbcType=BIGINT},
			</if>
			<if test="scaleId != null">
				#{scaleId,jdbcType=INTEGER},
			</if>
			<if test="testtype != null">
				#{testtype,jdbcType=INTEGER},
			</if>
			<if test="okTime != null">
				#{okTime,jdbcType=TIMESTAMP},
			</if>
			<if test="startTime != null">
				#{startTime,jdbcType=TIMESTAMP},
			</if>
			<if test="warningGrade != null">
				#{warningGrade,jdbcType=INTEGER},
			</if>
			<if test="validVal != null">
				#{validVal,jdbcType=INTEGER},
			</if>
			<if test="individualScore != null">
				#{individualScore,jdbcType=LONGVARCHAR},
			</if>
			<if test="questionScore != null">
				#{questionScore,jdbcType=LONGVARCHAR},
			</if>
			<if test="dimScore != null">
				#{dimScore,jdbcType=LONGVARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective"
		parameterType="com.njpes.www.entity.scaletoollib.ExamresultTeacherWithBLOBs">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		update examresult_teacher
		<set>
			<if test="teacherId != null">
				user_id = #{teacherId,jdbcType=BIGINT},
			</if>
			<if test="scaleId != null">
				scale_id = #{scaleId,jdbcType=INTEGER},
			</if>
			<if test="testtype != null">
				testtype = #{testtype,jdbcType=INTEGER},
			</if>
			<if test="okTime != null">
				ok_time = #{okTime,jdbcType=TIMESTAMP},
			</if>
			<if test="startTime != null">
				start_time = #{startTime,jdbcType=TIMESTAMP},
			</if>
			<if test="warningGrade != null">
				warning_grade = #{warningGrade,jdbcType=INTEGER},
			</if>
			<if test="validVal != null">
				valid_val = #{validVal,jdbcType=INTEGER},
			</if>
			<if test="individualScore != null">
				individual_score = #{individualScore,jdbcType=LONGVARCHAR},
			</if>
			<if test="questionScore != null">
				question_score = #{questionScore,jdbcType=LONGVARCHAR},
			</if>
			<if test="dimScore != null">
				dim_score = #{dimScore,jdbcType=LONGVARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=BIGINT}
	</update>
	<update id="updateByPrimaryKeyWithBLOBs"
		parameterType="com.njpes.www.entity.scaletoollib.ExamresultTeacherWithBLOBs">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		update examresult_teacher
		set user_id = #{teacherId,jdbcType=BIGINT},
		scale_id = #{scaleId,jdbcType=INTEGER},
		testtype = #{testtype,jdbcType=INTEGER},
		ok_time = #{okTime,jdbcType=TIMESTAMP},
		start_time = #{startTime,jdbcType=TIMESTAMP},
		warning_grade = #{warningGrade,jdbcType=INTEGER},
		valid_val = #{validVal,jdbcType=INTEGER},
		individual_score = #{individualScore,jdbcType=LONGVARCHAR},
		question_score = #{questionScore,jdbcType=LONGVARCHAR},
		dim_score = #{dimScore,jdbcType=LONGVARCHAR}
		where id = #{id,jdbcType=BIGINT}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.njpes.www.entity.scaletoollib.ExamresultTeacher">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Mar 21 
			23:18:41 CST 2015. -->
		update examresult_teacher
		set user_id = #{teacherId,jdbcType=BIGINT},
		scale_id = #{scaleId,jdbcType=INTEGER},
		testtype = #{testtype,jdbcType=INTEGER},
		ok_time = #{okTime,jdbcType=TIMESTAMP},
		start_time = #{startTime,jdbcType=TIMESTAMP},
		warning_grade = #{warningGrade,jdbcType=INTEGER},
		valid_val = #{validVal,jdbcType=INTEGER},
		<if test="iswarnsure != null">
				iswarnsure = #{iswarnsure,jdbcType=TINYINT},
		</if>
		where id = #{id,jdbcType=BIGINT}
	</update>

	<select id="getTeacherResultByPage" parameterType="com.njpes.www.entity.scaletoollib.ReportLookTeacherFilterParam" resultType="com.njpes.www.entity.scaletoollib.ExamresultTeacher">
		select es.id id,es.user_id teacherId,es.xm teacherName,es.valid_val validVal,es.gender gender,es.sfzjh indentify,es.roleid roleId,r.role_name roleName,sc.title scaleName,sc.questionnum	questionnum,es.warning_grade as warningGrade,es.testtype,es.start_time startTime,timestampdiff(second,es.start_time,es.ok_time) as second,es.ok_time okTime from examresult_teacher es
		left join scale sc on es.scale_id=sc.code
		left join role r on r.id=es.roleid
		where  es.orgid=${reportLookTeacherFilterParam.orgid}
	    <if test='reportLookTeacherFilterParam.roleid!=null and reportLookTeacherFilterParam.roleid!="-1"'>
		    and es.roleid =${reportLookTeacherFilterParam.roleid}
	    </if>
	    <if test='reportLookTeacherFilterParam.scaleId!=null and reportLookTeacherFilterParam.scaleId != "-1"'>
		    and es.scale_id =${reportLookTeacherFilterParam.scaleId}
	    </if>
	    <if test='reportLookTeacherFilterParam.warningLevel!=0 and reportLookTeacherFilterParam.warningLevel != "-1"'>
		    and es.warning_grade =${reportLookTeacherFilterParam.warningLevel}
	    </if>
	    <if test="reportLookTeacherFilterParam.validVal != null and reportLookTeacherFilterParam.validVal != -1">
		    and es.valid_val =${reportLookTeacherFilterParam.validVal}
	    </if>
	    <if test='reportLookTeacherFilterParam.username !=null and reportLookTeacherFilterParam.username!=""'>
		    and es.xm like '%${reportLookTeacherFilterParam.username}%'
	    </if>
	    <if test='reportLookTeacherFilterParam.gender !=null and reportLookTeacherFilterParam.gender!="-1"'>
		    and es.gender = ${reportLookTeacherFilterParam.gender}
	    </if>
	    <if test='reportLookTeacherFilterParam.starttime !=null and reportLookTeacherFilterParam.starttime !=""'>
		    and es.ok_time &gt;= '${reportLookTeacherFilterParam.starttime}'
	    </if>
	    <if test='reportLookTeacherFilterParam.endtime !=null and reportLookTeacherFilterParam.endtime !=""'>
		    and es.ok_time &lt;= '${reportLookTeacherFilterParam.endtime}'
	    </if>
	    Order By es.ok_time Desc
	</select>
	<select id="getTeacherPersonalReportByPage" parameterType="com.njpes.www.entity.scaletoollib.ReportLookTeacherFilterParam" resultType="com.njpes.www.entity.scaletoollib.ExamresultTeacher">
		select t.xm
		teacherName,t.xbm gender,t.sfzjh indentify,scale.title
		scaleName,scale.questionnum
		questionnum,timestampdiff(second,et.start_time,et.ok_time) as second,et.start_time
		startTime,et.testtype,et.ok_time okTime,et.warning_grade warningGrade from teacher
		t,scale
		scale,examresult_teacher et where et.user_id=t.id and
		et.scale_id=scale.code
		Order By et.ok_time Desc
	</select>
	<select id="getTeaComplianceReportByPage" parameterType="com.njpes.www.entity.scaletoollib.ReportLookTeacherFilterParam" resultType="com.njpes.www.entity.scaletoollib.ExamresultTeacher">
		select DISTINCT es.user_id teacherId,es.id id,es.xm teacherName,es.gender gender,es.sfzjh indentify,es.roleid roleId,r.role_name roleName,sc.title scaleName,sc.questionnum
		questionnum,es.start_time startTime,MAX(es.ok_time) okTime from examresult_teacher es
		left join scale sc on es.scale_id=sc.code
		left join role r on r.id=es.roleid
		where  es.orgid=${reportLookTeacherFilterParam.orgid}
	    <if test='reportLookTeacherFilterParam.roleid!=null and reportLookTeacherFilterParam.roleid!="-1"'>
		    and es.roleid =${reportLookTeacherFilterParam.roleid}
	    </if>
	    <if test='reportLookTeacherFilterParam.gender!=null and reportLookTeacherFilterParam.gender != "-1"'>
		    and es.gender =${reportLookTeacherFilterParam.gender}
	    </if>
	    <if test='reportLookTeacherFilterParam.username !=null and reportLookTeacherFilterParam.username!=""'>
		    and es.xm like '%${reportLookTeacherFilterParam.username}%'
	    </if>
	    <if test='reportLookTeacherFilterParam.identiyId!=null and reportLookTeacherFilterParam.identiyId !=""'>
		    and es.sfzjh = ${reportLookTeacherFilterParam.identiyId}
	    </if>
	    group by es.user_id order by es.ok_time
	</select>
	<!-- <select id="getTeacherAnswerInSchool" resultType="java.util.Map" parameterType="java.util.Map">
	    select t.xm,t.xbm,es.question_score  from 
	    (select es.user_id,max(es.ok_time) otime from examresult_teacher es
	    join user_org_job uoj on uoj.user_id = es.user_id where uoj.org_id=#{orgid}
	    join auth au on es.user_id=au.user_id where au.role_id=#{roleid}
	    and  es.scale_id = #{scaleid} and es.ok_time between #{startTime} and #{endTime} group by user_id)a 
	    join examresult_teacher es  on es.user_id= a.user_id   and es.ok_time=a.otime 
	    left join teacher t on t.id=es.user_id
	</select>-->
	<select id="getTeacherAnswerInSchool" resultType="java.util.Map" parameterType="java.util.Map">
	    select es.xm,es.sfzjh,es.gh,es.gender xbm,r.role_name rolename,es.question_score answerscore,es.dim_score dimscore,max(es.ok_time) otime,es.attrs 
	    from examresult_teacher es 
	    left join role r on r.id = es.roleid 
	    where es.orgid=#{orgid}
	    and es.roleid=#{roleid}   and  es.scale_id = #{scaleid} 
	    and es.ok_time between #{startTime} and #{endTime} 
	    group by user_id
	</select>
	<!-- <select id="getTeacherAnswerInEdu" resultType="java.util.Map" parameterType="java.util.Map">
	    select t.xm,t.xbm,es.question_score  from 
	    (select sc.xxmc,es.user_id,max(es.ok_time) otime from examresult_teacher es
	    join user_org_job uoj on uoj.user_id = es.user_id
	    join auth au on es.user_id=au.user_id where au.role_id=#{roleid} 
	    and uoj.org_id in (#{orgids})  and es.scale_id = #{scaleid}  
	    and es.ok_time between #{startTime} and #{endTime} group by user_id)a 
	    join examresult_teacher es  on es.user_id= a.user_id   and es.ok_time=a.otime 
	    left join teacher t on t.id=es.user_id
	</select>-->
	<select id="getTeacherAnswerInEdu" resultType="java.util.Map" parameterType="java.util.Map">
	    select es.xm,es.sfzjh,es.gh,es.gender xbm,eds.rolename,max(es.ok_time) otime,es.question_score answerscore,es.dim_score dimscore,es.attrs from examresult_teacher es
	    left join examdo_teacher eds on eds.id = es.id 
	    left join organization org on org.id = es.orgid and org.org_level=6
	    where 1=1
	    <if test="countyid != null">
	    and eds.countyid = #{countyid}
	    </if>
	    <if test="roleid != null and roleid!='-1'.toString()">
	        and es.roleid=#{roleid} 
	    </if>
	    and es.scale_id=#{scaleid}
	    and es.ok_time between #{startTime} and #{endTime} group by es.user_id
	</select>
	<select id="queryDistinctTeacherFromExamresultTeacher" resultType="com.njpes.www.entity.scaletoollib.ExamresultTeacher">
		select distinct et.roleid roleid,ro.role_name roleName from examresult_teacher et,role ro where et.roleid=ro.id and orgid=#{orgId}
	</select>
	<select id="queryTeacherDistinctScales" resultType="edutec.scale.model.Scale">
		select distinct et.scale_id id,sc.title shortname  from examresult_teacher et,scale sc where et.scale_id=sc.code and orgid=#{org.id}
	</select>
	<select id="getTeacherDistinctScales" resultType="com.njpes.www.entity.scaletoollib.ScaleInfo">
		select distinct et.scale_id code,sc.title title,sc.typeid scaletype,sc.source scalesource  from examresult_teacher et
		<if test='org.orgType!="2"'>
		    left join examdo_teacher eds on eds.id = et.id
		</if>
		left join scale sc on et.scale_id=sc.code
		left join organization og on og.id=et.orgid
		where 1=1 
		<if test='org.orgType=="2"'>
		   and et.orgid=#{org.id}
		</if>
		<if test='roleid!="-1" and roleid!="0" and roleid!=null'>
		   and et.roleid=#{roleid}
		</if>
		<if test='org.orgType!="2" and org.orgLevel== 4'>
		    <if test='countyidOrSchoolid!=null and countyidOrSchoolid!=""'>
		       and  eds.orgid=#{countyidOrSchoolid}
		    </if>
	       and eds.countyid=#{org.countyid}
	       and og.org_level = 6
	    </if>
	    <if test="isSonSchool ==false and org.orgLevel== 3">
	        <if test='countyidOrSchoolid!=null and countyidOrSchoolid!=""'>
		       and eds.countyid=#{countyidOrSchoolid}
		    </if>
	       and og.org_level = 6
	    </if>
	     <if test="isSonSchool ==true and org.orgLevel== 3">
	         <if test='countyidOrSchoolid!=null and countyidOrSchoolid!=""'>
		       and  et.orgid=#{countyidOrSchoolid}
		    </if>
	       and og.org_level &lt; 6
	    </if>
	    <if test="scaletype!=-1">
	        and sc.typeid=#{scaletype}
	    </if>
	    <if test="scalesource!=-1">
	        and sc.source=#{scalesource}
	    </if>
	</select>
	
	<!-- 查询学校的学生的所有测评结果，包含了市级、区县级、学校代码、年级id和班级id以及时间段 -->
	<select id="getTeacherResult" 
	    parameterType="com.njpes.www.entity.scaletoollib.StatScope" resultType="com.njpes.www.entity.scaletoollib.ExamresultHuman">
	   select es.id,es.user_id,es.xm,es.gender,es.csrq,es.sfzjh,es.gh,es.scale_id,
		s.title as scalename, es.question_score,es.dim_score,es.roleid,
 		es.ok_time,es.start_time,es.warning_grade,es.iswarnsure,es.xxmc as orgname, es.orgid,es.attrs 
 		from examresult_teacher es join scale s on s.code=es.scale_id
		 join organization org on es.orgid=org.id 
		 join school sch on sch.orgid = org.id 
		where 1=1
		<if test="cityId != null and cityId != 0">
			and org.cityid=#{cityId}
		</if>
		<if test="countyId != null and countyId.size()&gt;0">
			and org.countyid in 
			<foreach collection="countyId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="schoolId != null and schoolId.size()&gt;0">
			and sch.id in 
			<foreach collection="schoolId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scaleId != null and scaleId != 0">
			and es.scale_id=#{scaleId}
		</if>
		<if test="startTime != null">
			and es.ok_time&gt;=#{startTime}
		</if>
		<if test="endTime != null">
			and es.ok_time&lt;=#{endTime}
		</if>
	</select>
	<select id="getScaleListByTypeAndScope" 
	    resultType="com.njpes.www.entity.scaletoollib.ScaleInfo">
	   select s.code,s.title from examresult_teacher es join scale s on s.code=es.scale_id
		 join organization org on es.orgid=org.id 
		 join school sch on sch.orgid = org.id 
		where 1=1  
		<if test="scaletype != null and scaletype != 0">
			and s.typeid=#{scaletype}
		</if>
		<if test="scope.cityId != null and scope.cityId != 0">
			and org.cityid=#{scope.cityId}
		</if>
		<if test="scope.countyId != null and scope.countyId.size()&gt;0">
			and org.countyid in 
			<foreach collection="scope.countyId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		
		<if test="scope.schoolId != null and scope.schoolId.size()&gt;0">
			and sch.id in 
			<foreach collection="scope.schoolId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scope.gradeId != null and scope.gradeId != 0">
			and es.gradeorderid=#{scope.gradeId}
		</if>
		<if test="scope.classId != null and scope.classId != 0">
			and es.classid=#{scope.classId}
		</if>
		<if test="scope.startTime != null">
			and es.ok_time&gt;=#{scope.startTime}
		</if>
		<if test="scope.endTime != null">
			and es.ok_time&lt;=#{scope.endTime}
		</if>
		group by s.code,s.title
	</select>
	<select id="getScaleTypeByScope" resultType="java.lang.Integer">
	   select s.typeid from examresult_teacher es join scale s on s.code=es.scale_id
		 join organization org on es.orgid=org.id 
		 join school sch on sch.orgid = org.id 
		where 1=1  
		<if test="scope.cityId != null and scope.cityId != 0">
			and org.cityid=#{scope.cityId}
		</if>
		<if test="scope.countyId != null and scope.countyId.size()&gt;0">
			and org.countyid in 
			<foreach collection="scope.countyId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		
		<if test="scope.scaleId != null and scope.scaleId != 0">
			and es.scale_id=#{scope.scaleId}
		</if>
		<if test="scope.schoolId != null and scope.schoolId.size()&gt;0">
			and sch.id in 
			<foreach collection="scope.schoolId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scope.gradeId != null and scope.gradeId != 0">
			and es.gradeorderid=#{scope.gradeId}
		</if>
		<if test="scope.classId != null and scope.classId != 0">
			and es.classid=#{scope.classId}
		</if>
		<if test="scope.startTime != null">
			and es.ok_time&gt;=#{scope.startTime}
		</if>
		<if test="scope.endTime != null">
			and es.ok_time&lt;=#{scope.endTime}
		</if>
		group by s.typeid
	</select>
	<!-- 查询分发量表任务的时间列表 -->
	<select id="getTaskTimesByTypeAndScope" resultType="com.njpes.www.entity.scaletoollib.ExamDoSchoolTask">
	   select ets.id, ets.starttime from examdo_teacher es 
		join examdo_task_school ets on es.taskid=ets.id 
		join scale sca on es.scale_id=sca.code
		join organization org on es.orgid=org.id 
		join school sch on sch.orgid = org.id
		where 1=1
		<if test="scope.cityId != null and scope.cityId != 0">
			and org.cityid=#{scope.cityId}
		</if>
		<if test="scope.countyId != null and scope.countyId.size()&gt;0">
			and org.countyid in 
			<foreach collection="scope.countyId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scope.schoolId != null and scope.schoolId.size()&gt;0">
			and sch.id in 
			<foreach collection="scope.schoolId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scope.scaleId != null and scope.scaleId != 0">
			and es.scale_id=#{scope.scaleId}
		</if>
		<if test="scope.startTime != null">
			and es.ok_time&gt;=#{scope.startTime}
		</if>
		<if test="scope.endTime != null">
			and es.ok_time&lt;=#{scope.endTime}
		</if>
		group by ets.id, ets.starttime
	</select>
	<!-- 查询所有测评结果，根据taskid分组 -->
	<select id="getTeacherResultsByTaskId" resultType="com.njpes.www.entity.scaletoollib.ExamresultHuman">
	  select es.id,es.user_id,es.xm,es.gender,es.csrq,es.sfzjh,es.gh,es.scale_id,
		sca.title as scalename, es.question_score,es.dim_score,es.roleid,
 		es.ok_time,es.start_time,es.warning_grade,es.iswarnsure,es.xxmc as orgname, es.orgid,es.attrs 
		 from examresult_teacher es 
		 join organization org on es.orgid=org.id 
		 join school sch on sch.orgid = org.id 
		 join scale sca on sca.code=es.scale_id
	     join examdo_teacher edo on es.id=edo.id
	     join examdo_task_school ets on ets.id=edo.taskid
		where 1=1
		<if test="scope.cityId != null and scope.cityId != 0">
			and org.cityid=#{scope.cityId}
		</if>
		<if test="scope.countyId != null and scope.countyId.size()&gt;0">
			and org.countyid in 
			<foreach collection="scope.countyId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scope.scaleId != null and scope.scaleId != 0">
			and es.scale_id=#{scope.scaleId}
		</if>
		<if test="scope.schoolId != null and scope.schoolId.size()&gt;0">
			and sch.id in 
			<foreach collection="scope.schoolId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scope.startTime != null">
			and es.ok_time&gt;=#{scope.startTime}
		</if>
		<if test="scope.endTime != null">
			and es.ok_time&lt;=#{scope.endTime}
		</if>
		<if test="taskid != null">
			and edo.taskid=#{taskid}
		</if>
		order by es.user_id
	</select>
	<select id="QueryScaleList" resultType="com.njpes.www.entity.scaletoollib.ScaleInfo">
		select distinct es.scale_id code,sc.title from examresult_teacher es,scale sc where es.scale_id=sc.code and sc.typeid=#{param.typeid}
	</select>
	<!-- 查询所有测评结果，task分组 -->
	<select id="getTeacherResultByTask" resultType="com.njpes.www.entity.scaletoollib.StatExamResultTask">
	   select 
	     edo.taskid,ets.taskname,sca.code,sca.title,ets.starttime
		 from examresult_teacher es 
		 join organization org on es.orgid=org.id 
		 join school sch on sch.orgid = org.id 
		 join scale sca on sca.code=es.scale_id
	     join examdo_teacher edo on es.id=edo.id
	     join examdo_task_school ets on ets.id=edo.taskid
		where 1=1
		<if test="scope.cityId != null and scope.cityId != 0">
			and org.cityid=#{scope.cityId}
		</if>
		<if test="scope.countyId != null and scope.countyId.size()&gt;0">
			and org.countyid in 
			<foreach collection="scope.countyId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
		<if test="scope.scaleId != null and scope.scaleId != 0">
			and es.scale_id=#{scope.scaleId}
		</if>
		<if test="scope.schoolId != null and scope.schoolId.size()&gt;0">
			and sch.id in 
			<foreach collection="scope.schoolId" index="index" item="item" open="(" separator="," close=")">
            	#{item}
        	</foreach>
		</if>
	<if test="scope.startTime != null">
			and es.ok_time&gt;=#{scope.startTime}
		</if>
		<if test="scope.endTime != null">
			and es.ok_time&lt;=#{scope.endTime}
		</if>
		<if test="typeid != null">
			and sca.typeid=#{typeid}
		</if>
	</select>
	<select id="selectDistinctQuxianFromExamresultTeacher" resultType="com.njpes.www.entity.baseinfo.District">
      select distinct eds.countyid code,ar.name from examresult_teacher es
      left join examdo_teacher eds on es.id = eds.id 
      left join newarea ar on ar.code = eds.countyid 
      left join organization og on og.id=es.orgid
      where og.org_level=6 and og.org_type=2
  </select>
  <select id="selectDistinctSubSchoolFromExamresultTeacher" resultType="com.njpes.www.entity.baseinfo.organization.Organization">
      select distinct es.orgid id,og.name name from examresult_teacher es
      left join organization og on og.id=es.orgid
      where og.org_level=4 and og.org_type=2
  </select>
  	<select id="selectDistinctRoleFromExamresultTeacher" resultType="com.njpes.www.entity.baseinfo.Role">
      select distinct eds.roleid id ,eds.rolename roleName from examresult_teacher es
      left join examdo_teacher eds on es.id = eds.id 
      <if test='org.orgType=="2"'>
          where es.orgid=#{org.id}
      </if>
      <if test='org.orgType!="2" and org.orgLevel==4'>
          left join organization og on og.id = eds.orgid
          where eds.countyid=#{org.countyid}  and og.org_level=6
      </if>
  </select>
  <select id="getDistinctRoleFromExamresultTeacher" resultType="com.njpes.www.entity.baseinfo.Role">
      select distinct eds.roleid id ,eds.rolename roleName from examresult_teacher et,examdo_teacher eds  
      <if test='org.orgType!="2"'>
          ,organization og
      </if>
      where  et.id = eds.id
      <if test='org.orgType=="2"'>
		   and et.orgid=#{org.id}
	  </if>
		<if test='org.orgType!="2" and org.orgLevel== 4'>
		     <if test='countyidOrSchoolid!=null and countyidOrSchoolid!=""'>
		       and eds.countyid=#{countyidOrSchoolid}
		    </if>
		   and og.id=et.orgid
	       and eds.countyid=#{org.countyid}
	       and og.org_level = 6
	    </if>
	    <if test="isSonSchool ==false and org.orgLevel== 3">
	         <if test='countyidOrSchoolid!=null and countyidOrSchoolid!=""'>
		       and  eds.countyid=#{countyidOrSchoolid}
		    </if>
	       and og.id=et.orgid
	       and og.org_level = 6
	    </if>
	     <if test="isSonSchool ==true and org.orgLevel== 3">
	          <if test='countyidOrSchoolid!=null and countyidOrSchoolid!=""'>
		       and  et.orgid=#{countyidOrSchoolid}
		    </if>
	       and og.id=et.orgid
	       and og.org_level &lt; 6
	    </if>
  </select>
  <select id="getSchoolsFromExamresultTeacher" resultType="com.njpes.www.entity.baseinfo.organization.Organization">
	    select distinct og.id,og.name from examresult_teacher es
	    left join  organization og on og.id=es.orgid
	     where og.countyid =#{countyid} and org_level=6 and org_type=2
	</select>
</mapper>