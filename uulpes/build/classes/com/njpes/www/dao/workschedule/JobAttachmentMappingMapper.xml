<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.njpes.www.dao.workschedule.JobAttachmentMappingMapper" >
  <resultMap id="BaseResultMap" type="com.njpes.www.entity.workschedule.JobAttachmentMapping" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="sort" property="sort" jdbcType="INTEGER" />
    <result column="fid" property="fid" jdbcType="BIGINT" />
    <result column="jobfileid" property="jobfileid" jdbcType="BIGINT" />
    <result column="resource" property="resource" jdbcType="VARCHAR" />
    <association property="jobattachment" javaType="com.njpes.www.entity.workschedule.JobAttachment">
    	<id column="fileid" jdbcType="BIGINT" property="id" />
    	<result column="name" jdbcType="VARCHAR" property="name" />
    	<result column="mine_type" jdbcType="VARCHAR" property="mineType" />
     	<result column="writetime" jdbcType="DATE" property="writetime" />
      	<result column="save_path" jdbcType="LONGVARCHAR" property="savePath" />
    	<result column="locationpath" jdbcType="LONGVARCHAR" property="locationpath" />
    	<result column="uuid" jdbcType="VARCHAR" property="uuid" />
    	<result column="showfirstpage" jdbcType="VARCHAR" property="showfirstpage" />
    </association>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    t.id, sort, t.fid, jobfileid, resource
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from job_attachment_mapping t
    where t.id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    delete from job_attachment_mapping
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.njpes.www.entity.workschedule.JobAttachmentMapping" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    insert into job_attachment_mapping (id, sort, fid, 
      jobfileid, resource)
    values (#{id,jdbcType=BIGINT}, #{sort,jdbcType=INTEGER}, #{fid,jdbcType=BIGINT}, 
      #{jobfileid,jdbcType=BIGINT}, #{resource,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.njpes.www.entity.workschedule.JobAttachmentMapping" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    insert into job_attachment_mapping
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="sort != null" >
        sort,
      </if>
      <if test="fid != null" >
        fid,
      </if>
      <if test="jobfileid != null" >
        jobfileid,
      </if>
      <if test="resource != null" >
        resource,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="sort != null" >
        #{sort,jdbcType=INTEGER},
      </if>
      <if test="fid != null" >
        #{fid,jdbcType=BIGINT},
      </if>
      <if test="jobfileid != null" >
        #{jobfileid,jdbcType=BIGINT},
      </if>
      <if test="resource != null" >
        #{resource,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.njpes.www.entity.workschedule.JobAttachmentMapping" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    update job_attachment_mapping
    <set >
      <if test="sort != null" >
        sort = #{sort,jdbcType=INTEGER},
      </if>
      <if test="fid != null" >
        fid = #{fid,jdbcType=BIGINT},
      </if>
      <if test="jobfileid != null" >
        jobfileid = #{jobfileid,jdbcType=BIGINT},
      </if>
      <if test="resource != null" >
        resource = #{resource,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.njpes.www.entity.workschedule.JobAttachmentMapping" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Dec 10 01:07:12 CST 2015.
    -->
    update job_attachment_mapping
    set sort = #{sort,jdbcType=INTEGER},
      fid = #{fid,jdbcType=BIGINT},
      jobfileid = #{jobfileid,jdbcType=BIGINT},
      resource = #{resource,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <delete id="deleteFileByFidResource">
  	delete from job_attachment_mapping 
  	<where>
  		<if test="fid !=null and fid>0">
  			and fid=#{fid,jdbcType=BIGINT}
  		</if>
  		<if test="fileid !=null and fileid>0">
  			and jobfileid=#{fileid,jdbcType=BIGINT}
  		</if>
  		<if test="res !=null and fileid!=''">
  			and resource=#{res,jdbcType=VARCHAR}
  		</if>
  	</where>
  </delete>
  <select id="selectFileIdsByFidResource" resultMap="BaseResultMap">
  	select t.id,t.fid,jobfileid,resource,
	f.id as fileid,  name, mine_type,save_path,locationpath,writetime,uuid,showfirstpage
 	from job_attachment_mapping t
  	left join job_attachment f on t.jobfileid=f.id
  	<where>
  		<if test="fid !=null and fid>0">
  			and t.fid=#{fid,jdbcType=BIGINT}
  		</if>
  		<if test="res !=null and res !=''">
  			and resource=#{res,jdbcType=VARCHAR}
  		</if>
  	</where>
  </select>
  <select id="selectimageUrlShowFirstpage" resultType="java.lang.String">
  	select f.save_path from job_attachment  f 
	left join job_attachment_mapping map on f.id=map.jobfileid
	where f.showfirstpage ='1' 
  		<if test="fid !=null and fid>0">
  			and map.fid=#{fid,jdbcType=BIGINT}
  		</if>
  		<if test="res !=null and res !=''">
  			and resource=#{res,jdbcType=VARCHAR}
  		</if>
  	limit 1
  </select>
</mapper>